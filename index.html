// --- 5. S√âLECTEUR DE TECHNIQUE (bas√© sur techniques.csv, avec lien YouTube)
let techniques = [];

function chargerTechniques() {
  fetch('data/techniques.csv')
    .then(r => r.text())
    .then(csv => {
      const lignes = csv.trim().split('\n').slice(1); // sauter l'en-t√™te
      techniques = lignes
        .filter(ligne => ligne.trim() !== '')
        .map(ligne => {
          const parts = ligne.split(';'); // s√©parateur : point-virgule
          if (parts.length < 8) return null; // on attend 8 colonnes

          return {
            id: parts[0].trim(),
            nom: parts[1].replace(/"/g, '').trim(),
            description: parts[2].replace(/"/g, '').trim(),
            materiel: parts[3].replace(/"/g, '').trim(),
            niveau: parts[4].replace(/"/g, '').trim(),
            image: parts[5].replace(/"/g, '').trim(),
            lien_youtube: parts[7].replace(/"/g, '').trim() // colonne 8 = lien YouTube
          };
        })
        .filter(Boolean);
    })
    .catch(err => {
      console.error("Erreur chargement techniques :", err);
      document.getElementById("technique").innerText = "‚ùå Erreur de chargement des techniques.";
    });
}

function choisirTechnique() {
  const techEl = document.getElementById("technique");
  const matEl = document.getElementById("materiel");
  const lienEl = document.getElementById("lien");

  if (techniques.length === 0) {
    techEl.innerHTML = `<em>Chargement en cours‚Ä¶</em>`;
    matEl.innerText = "";
    lienEl.style.display = "none";
    return;
  }

  const tech = techniques[Math.floor(Math.random() * techniques.length)];

  // Badges niveau
  const badgesNiveau = tech.niveau
    .split(',')
    .map(n => n.trim())
    .map(n => `<span style="background:#3b82f6; color:white; padding:2px 6px; margin:2px 3px; border-radius:4px; font-size:0.8em;">${n}</span>`)
    .join("");

  // Image
  let img = document.getElementById("preview-technique");
  if (!img) {
    img = document.createElement("img");
    img.id = "preview-technique";
    img.alt = tech.nom;
    img.style = "max-width:100%; border-radius:8px; margin:12px 0; box-shadow:0 2px 8px rgba(0,0,0,0.1);";
    matEl.insertAdjacentElement("afterend", img);
  }
  img.src = tech.image;

  // Affichage
  techEl.innerHTML = `
    <strong style="font-size:1.3em;">${tech.nom}</strong><br>
    ${badgesNiveau}<br>
    <em style="font-size:0.95em; color:#555;">‚Äú${tech.description}‚Äù</em>
  `;
  matEl.innerText = `üñåÔ∏è Mat√©riel : ${tech.materiel}`;

  // üîó Lien YouTube (si pr√©sent)
  if (tech.lien_youtube && tech.lien_youtube.startsWith('http')) {
    lienEl.href = tech.lien_youtube;
    lienEl.textContent = "‚ñ∂Ô∏è Voir la cha√Æne YouTube";
    lienEl.target = "_blank";
    lienEl.rel = "noopener";
    lienEl.style.cssText = `
      display: inline-block;
      margin-top: 10px;
      color: #1e40af;
      text-decoration: none;
      font-weight: bold;
    `;
  } else {
    lienEl.style.display = "none";
  }
}
