<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Techniques Cr√©atives ‚Äì CreaSoley</title>
  <link rel="stylesheet" href="../css/style.css">
  <link rel="stylesheet" href="../css/theme.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; max-width: 900px; margin: auto; }
    h1 { text-align: center; color: #3b82f6; }
    .card { padding: 20px; border: 1px solid #ddd; border-radius: 10px; margin-top: 20px; }
    label { font-weight: bold; display: block; margin-top: 10px; }
    button { padding: 10px 18px; margin: 5px; cursor: pointer; background: #3b82f6; color: white; border: none; border-radius: 5px; }
    button:hover { background: #2a64d8; }
    img { max-width: 100%; margin-top: 10px; border-radius: 8px; }
    fieldset { border: 1px solid #ddd; padding: 10px; border-radius: 5px; margin-bottom: 10px; }
    .technique-card { border: 1px solid #eee; padding: 10px; margin-bottom: 10px; border-radius: 5px; cursor: pointer; }
  </style>
</head>
<body>
  <!-- Bandeau (identique √† l'accueil) -->
  <nav class="navbar">
    <a href="../index.html" class="logo-link">
      <img src="../assets/images/logo-creasoley.svg" alt="CreaSoley - Logo" class="logo-img">
      <span class="logo-title">CreaSoley</span>
    </a>
    <ul class="nav-menu">
      <li><a href="../index.html">Accueil</a></li>
      <li><a href="inspiration.html">Inspiration</a></li>
      <li><a href="portfolio.html">Portfolio</a></li>
      <li><a href="carnet.html">Carnet</a></li>
      <li><a href="techniques.html">Techniques</a></li>
    </ul>
  </nav>

  <div class="page-content" style="padding: 20px; max-width: 900px; margin: auto;">
    <h1>üé® Techniques Cr√©atives</h1>

    <!-- Recherche par nom -->
    <div>
      <label>Rechercher une technique :</label>
      <input type="text" id="techInput" placeholder="Ex: Aquarelle" />
      <button onclick="searchByName()">Rechercher</button>
    </div>

    <!-- Filtre par niveau -->
    <fieldset>
      <legend>Filtrer par niveau :</legend>
      <label><input type="checkbox" name="level" value="D√©butant" checked> D√©butant</label>
      <label><input type="checkbox" name="level" value="Interm√©diaire" checked> Interm√©diaire</label>
      <label><input type="checkbox" name="level" value="Avanc√©" checked> Avanc√©</label>
      <button onclick="searchByLevels()">Filtrer</button>
      <button onclick="showAll()">Tout afficher</button>
    </fieldset>

    <!-- Tirage al√©atoire -->
    <button onclick="randomTechnique()">‚ú® Technique Al√©atoire</button>

    <!-- R√©sultats -->
    <div id="result" class="card" style="display:none;"></div>

    <!-- Favoris -->
    <div id="favorites" style="margin-top: 20px; display: none;"></div>
  </div>

  <footer style="text-align: center; margin-top: 40px; padding: 10px; background: #f8f9fa;">
    Mon Atelier Cr√©atif ‚Ä¢ 2025
  </footer>

  <!-- Scripts -->
  <script>
    // Remplacez par votre URL Google Apps Script
    const API = "https://script.google.com/macros/s/AKfycbz5Jho8zDNyWAsnjzrbA24FGVk4fgqLQcybmbOkz0MzwsjMh3wJ0GjjzxUui_RiWQwe3g/exec"; // √Ä remplacer !

    // Recherche par nom
    async function searchByName() {
      const name = document.getElementById("techInput").value.trim();
      if (!name) return alert("Veuillez entrer un nom");
      const data = await fetchJson(`${API}?action=getTechnique&name=${encodeURIComponent(name)}`);
      render(data);
    }

    // Recherche par niveaux
    async function searchByLevels() {
      const levels = Array.from(document.querySelectorAll('input[name="level"]:checked')).map(el => el.value);
      if (levels.length === 0) return alert("S√©lectionnez au moins un niveau");
      const promises = levels.map(level => fetchJson(`${API}?action=getByLevel&level=${encodeURIComponent(level)}`));
      const results = await Promise.all(promises);
      const allTechniques = results.flat();
      if (!allTechniques.length) return alert("Aucune technique trouv√©e");
      renderList(allTechniques);
    }

    // Affiche toutes les techniques
    async function showAll() {
      const all = await fetchJson(`${API}?action=getAll`);
      renderList(all);
    }

    // Tirage al√©atoire
    async function randomTechnique() {
      const data = await fetchJson(`${API}?action=getRandom`);
      render(data);
    }

    // R√©cup√®re les donn√©es JSON
    async function fetchJson(url) {
      const res = await fetch(url);
      if (!res.ok) throw new Error(`Erreur ${res.status}: ${res.statusText}`);
      return res.json();
    }

    // Affiche une technique
    function render(obj) {
      if (obj.error) return alert(obj.error);
      const div = document.getElementById("result");
      div.style.display = "block";
      div.innerHTML = `
        <h2>${obj.nom}</h2>
        <p><strong>Niveau :</strong> ${obj.niveau}</p>
        <p>${obj.description}</p>
        <p><strong>Mat√©riel :</strong> ${obj.materiel || "Non sp√©cifi√©"}</p>
        ${obj.lienYoutube ? `<p><a href="${obj.lienYoutube}" target="_blank">üé• Voir la vid√©o</a></p>` : ""}
        ${obj.photo ? `<img src="${obj.photo}" alt="${obj.nom}" />` : ""}
        <p><strong>Galerie :</strong> ${obj.galerie || "Aucune"}</p>
        <div style="margin-top: 15px;">
          <button onclick="downloadPDF('${obj.nom}')">üìÑ T√©l√©charger le PDF</button>
          <button onclick="saveFavorite('${obj.nom}')">‚≠ê Ajouter aux favoris</button>
        </div>
      `;
    }

    // Affiche une liste de techniques
    function renderList(techniques) {
      const div = document.getElementById("result");
      div.style.display = "block";
      div.innerHTML = `
        <h2>R√©sultats (${techniques.length})</h2>
        ${techniques.map(obj => `
          <div class="technique-card" onclick="render(${JSON.stringify(obj)})">
            <h3>${obj.nom}</h3>
            <p><strong>Niveau:</strong> ${obj.niveau}</p>
            <p>${obj.description.substring(0, 100)}...</p>
          </div>
        `).join("")}
      `;
    }

    // T√©l√©chargement du PDF
    async function downloadPDF(name) {
      try {
        const response = await fetch(`${API}?action=getPDF&name=${encodeURIComponent(name)}`);
        if (!response.ok) throw new Error("√âchec de la g√©n√©ration du PDF");
        const blob = await response.blob();
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement("a");
        a.href = url;
        a.download = `${name}.pdf`;
        a.click();
        window.URL.revokeObjectURL(url);
      } catch (error) {
        alert("Erreur: " + error.message);
      }
    }

    // Gestion des favoris
    function saveFavorite(name) {
      let favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      if (!favorites.includes(name)) {
        favorites.push(name);
        localStorage.setItem("favorites", JSON.stringify(favorites));
        alert(`${name} ajout√© aux favoris !`);
        showFavorites();
      }
    }

    function showFavorites() {
      const favorites = JSON.parse(localStorage.getItem("favorites") || "[]");
      const div = document.getElementById("favorites");
      if (favorites.length === 0) {
        div.style.display = "none";
        return;
      }
      div.style.display = "block";
      div.innerHTML = `
        <h3>üåü Vos Techniques Favorites</h3>
        <div style="display: flex; flex-wrap: wrap; gap: 10px;">
          ${favorites.map(name => `
            <button onclick="renderByName('${name}')" style="padding: 5px 10px; background: #f0f0f0; border-radius: 5px;">
              ${name} ‚úñ
            </button>
          `).join("")}
        </div>
      `;
    }

    async function renderByName(name) {
      const data = await fetchJson(`${API}?action=getTechnique&name=${encodeURIComponent(name)}`);
      render(data);
    }

    // Charge les favoris au d√©marrage
    document.addEventListener("DOMContentLoaded", showFavorites);
  </script>
</body>
</html>
